<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Registro de Baterias Defeituosas</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

    :root {
      --cor-primaria: #0033a0;
      --cor-secundaria: #ffd700;
      --cor-fundo: #f4f7fc;
      --cor-texto: #333;
      --cor-branca: #ffffff;
      --sombra: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--cor-fundo);
      color: var(--cor-texto);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background-color: var(--cor-primaria);
      color: var(--cor-branca);
      padding: 1rem 0;
      box-shadow: var(--sombra);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--cor-secundaria);
    }

    .nav-menu {
      list-style: none;
      display: flex;
      gap: 25px;
    }

    .nav-link {
      color: var(--cor-branca);
      text-decoration: none;
      font-weight: 500;
      padding: 8px 15px;
      border-radius: 5px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .nav-link:hover, .nav-link.active {
      background-color: var(--cor-secundaria);
      color: var(--cor-primaria);
    }

    #btnConectarCarteira {
      background-color: var(--cor-secundaria);
      color: var(--cor-primaria);
      font-weight: 700;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #statusConexao {
      margin-top: 5px;
      font-size: 0.8rem;
      color: #ccc;
    }

    main {
      padding-top: 40px;
    }

    .content-section {
      background-color: var(--cor-branca);
      padding: 30px;
      border-radius: 10px;
      box-shadow: var(--sombra);
      margin-bottom: 30px;
      display: none;
    }

    .content-section.active {
      display: block;
    }

    h1, h2 {
      color: var(--cor-primaria);
      margin-bottom: 20px;
    }

    h1 { text-align: center; font-size: 2.5rem; }
    h2 { font-size: 1.8rem; border-bottom: 3px solid var(--cor-secundaria); padding-bottom: 10px; }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 500;
      margin-bottom: 8px;
      color: #555;
    }

    input, select {
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }

    .btn-submit {
      background-color: var(--cor-primaria);
      color: var(--cor-branca);
      padding: 15px 25px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 700;
      margin-top: 20px;
      grid-column: 1 / -1;
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    thead {
      background-color: var(--cor-primaria);
      color: var(--cor-branca);
    }

    tbody tr:nth-child(even) {
      background-color: var(--cor-fundo);
    }

    tbody tr:hover {
      background-color: #e9effc;
    }

    #notificacao {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 30px;
      border-radius: 8px;
      color: var(--cor-branca);
      font-weight: 500;
      box-shadow: var(--sombra);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    #notificacao.show { opacity: 1; visibility: visible; }
    #notificacao.success { background-color: #28a745; }
    #notificacao.error { background-color: #dc3545; }
  </style>
</head>
<body>
<header>
  <div class="navbar">
    <div class="logo">MOURA</div>
    <ul class="nav-menu">
      <li><a href="#" class="nav-link active" onclick="mostrarSecao('registro')">Registrar Bateria</a></li>
      <li><a href="#" class="nav-link" onclick="mostrarSecao('listar')">Listar Baterias</a></li>
    </ul>
    <div>
      <button id="btnConectarCarteira">Conectar Carteira</button>
      <div id="statusConexao">Status: Desconectado</div>
    </div>
  </div>
</header>

  <main class="container">
    <h1>Sistema de Registro de Baterias Defeituosas</h1>

    <section id="registro" class="content-section active">
      <h2>Registrar Nova Bateria Defeituosa</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="tipo">Tipo da Bateria (Ex: AGM, EFB):</label>
          <input id="tipo" type="text" />
        </div>
        <div class="form-group">
          <label for="uso">Tipo de Uso:</label>
          <select id="uso">
            <option value="automotivo">Automotivo</option>
            <option value="estacionária">Estacionária</option>
            <option value="acumulador">Acumulador</option>
            <option value="náutica">Náutica</option>
            <option value="industrial">Industrial</option>
          </select>
        </div>
        <div class="form-group">
          <label for="numeroSerie">Número de Série:</label>
          <input id="numeroSerie" type="text" />
        </div>
        <div class="form-group">
          <label for="dataProducao">Data de Produção:</label>
          <input id="dataProducao" type="date" />
        </div>
        <div class="form-group">
          <label for="lote">Lote de Fabricação:</label>
          <input id="lote" type="text" />
        </div>
        <button class="btn-submit" onclick="registrarBateria()">Registrar Bateria</button>
      </div>
    </section>

    <section id="listar" class="content-section">
      <h2>Baterias Defeituosas Registradas</h2>
      <button class="btn-submit" onclick="listarBaterias()">Listar Baterias</button>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nº de Série</th>
                            <th>Tipo</th>
              <th>Uso</th>
              <th>Lote</th>
              <th>Data de Produção</th>
              <th>Data de Registro</th>
            </tr>
          </thead>
          <tbody id="lista"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="notificacao"></div>

  <script>
    const abi = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "numeroSerie",
				"type": "string"
			}
		],
		"name": "BateriaRegistrada",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_tipo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_uso",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_numeroSerie",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_dataProducao",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_lote",
				"type": "string"
			}
		],
		"name": "registrarBateria",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "baterias",
		"outputs": [
			{
				"internalType": "string",
				"name": "tipo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "uso",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "numeroSerie",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "dataProducao",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "lote",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getBateria",
		"outputs": [
			{
				"internalType": "string",
				"name": "tipo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "uso",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "numeroSerie",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "dataProducao",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "lote",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "listar",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "tipo",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "uso",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "numeroSerie",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "dataProducao",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "lote",
						"type": "string"
					}
				],
				"internalType": "struct BateriasDefeituosas.Bateria[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
    const contratoEndereco = "0x95A0A6F7872a152B937DbDbC49f345ce271bFFbC";

    let web3;
    let contrato;

    async function conectar() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        contrato = new web3.eth.Contract(abi, contratoEndereco);
        document.getElementById("statusConexao").textContent = "Status: Conectado";
        mostrarNotificacao("success", "✅ Carteira conectada!");
      } else {
        mostrarNotificacao("error", "⚠️ MetaMask não detectado.");
      }
    }

    document.getElementById("btnConectarCarteira").addEventListener("click", conectar);

    async function registrarBateria() {
      await conectar();
      const tipo = document.getElementById("tipo").value;
      const uso = document.getElementById("uso").value;
      const numeroSerie = document.getElementById("numeroSerie").value;
      const dataProducao = document.getElementById("dataProducao").value;
      const lote = document.getElementById("lote").value;

      const contas = await web3.eth.getAccounts();
      await contrato.methods.registrarBateria(tipo, uso, numeroSerie, dataProducao, lote)
        .send({ from: contas[0] });

      mostrarNotificacao("success", "✅ Bateria registrada com sucesso!");
    }

    async function listarBaterias() {
      await conectar();
      const baterias = await contrato.methods.listar().call();
      const lista = document.getElementById("lista");
      lista.innerHTML = "";

      baterias.forEach((b, i) => {
        const row = document.createElement("tr");
        const dataRegistro = new Date().toLocaleDateString("pt-BR");
        row.innerHTML = `
          <td>${i}</td>
          <td>${b.numeroSerie}</td>
          <td>${b.tipo}</td>
          <td>${b.uso}</td>
          <td>${b.lote}</td>
          <td>${b.dataProducao}</td>
          <td>${dataRegistro}</td>
        `;
        lista.appendChild(row);
      });
    }

    function mostrarSecao(id) {
      document.querySelectorAll(".content-section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");

      document.querySelectorAll(".nav-link").forEach(link => link.classList.remove("active"));
      document.querySelector(`.nav-link[onclick="mostrarSecao('${id}')"]`).classList.add("active");
    }

    function mostrarNotificacao(tipo, mensagem = "") {
      const notificacao = document.getElementById("notificacao");
      notificacao.className = `show ${tipo}`;
      notificacao.textContent = mensagem;
      setTimeout(() => {
        notificacao.className = "";
        notificacao.textContent = "";
      }, 3000);
    }
  </script>
</body>
</html>