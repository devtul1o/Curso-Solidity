<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Sistema de Registro de Baterias Defeituosas</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    :root {
      --cor-primaria: #1a2e4f;
      --cor-secundaria: #f5f5f5;
      --cor-destaque: #0078d4;
      --cor-texto: #333;
      --cor-branca: #ffffff;
      --cor-borda: #ccc;
      --cor-hover: #e6f0ff;
      --sombra-box: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--cor-secundaria);
      color: var(--cor-texto);
      margin: 0;
      padding: 0;
    }

    header {
      background-color: var(--cor-primaria);
      color: var(--cor-branca);
      padding: 20px;
      text-align: center;
      font-size: 1.6rem;
      font-weight: 600;
      box-shadow: var(--sombra-box);
    }

    .navbar {
      display: flex;
      justify-content: center;
      background-color: var(--cor-primaria);
      padding: 10px 0;
    }

    .nav-menu {
      display: flex;
      gap: 30px;
    }

    .nav-link {
      color: var(--cor-branca);
      text-decoration: none;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }

    .nav-link:hover,
    .nav-link.active {
      background-color: var(--cor-destaque);
      color: var(--cor-branca);
    }

    main {
      padding: 40px 60px;
    }

    h2 {
      font-size: 1.8rem;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--cor-destaque);
      padding-bottom: 10px;
      color: var(--cor-primaria);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 600;
      margin-bottom: 8px;
    }

    input, select {
      padding: 10px;
      border: 1px solid var(--cor-borda);
      border-radius: 4px;
      font-size: 1rem;
      background-color: var(--cor-branca);
    }

    .btn-submit {
      background-color: var(--cor-destaque);
      color: var(--cor-branca);
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--sombra-box);
      transition: background-color 0.3s ease;
      margin-top: 10px;
    }

    .btn-submit:hover {
      background-color: #005ea2;
    }

    .table-container {
      overflow-x: auto;
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: var(--cor-branca);
      box-shadow: var(--sombra-box);
    }

    th, td {
      padding: 14px;
      text-align: left;
      border-bottom: 1px solid var(--cor-borda);
    }

    thead {
      background-color: var(--cor-primaria);
      color: var(--cor-branca);
    }

    tbody tr:nth-child(even) {
      background-color: #f0f0f0;
    }

    tbody tr:hover {
      background-color: var(--cor-hover);
    }

    .notificacao {
      position: fixed;
      bottom: 20px;
      left: 20px;
      padding: 15px 25px;
      background-color: #333;
      color: white;
      border-radius: 5px;
      box-shadow: var(--sombra-box);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
      z-index: 999;
    }

    .notificacao.show {
      opacity: 1;
      visibility: visible;
    }

    .notificacao.sucesso {
      background-color: #4BB543;
    }

    .notificacao.erro {
      background-color: #DC3545;
    }

    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }
  </style>
</head>
<body>
  <header>Sistema de Registro de Baterias Defeituosas</header>
  <div class="navbar">
    <div class="nav-menu">
      <a href="#" class="nav-link active" onclick="mostrarSecao('registro')">Registrar Bateria</a>
      <a href="#" class="nav-link" onclick="mostrarSecao('gerenciar')">Gerenciar Baterias</a>
    </div>
  </div>

  <main>
    <section id="registro" class="content-section active">
      <h2>Registrar Nova Bateria Defeituosa</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="tipo">Tipo de Bateria:</label>
          <input id="tipo" type="text" />
        </div>
        <div class="form-group">
          <label for="uso">Tipo de Uso:</label>
          <select id="uso">
            <option value="Automotivo">Automotivo</option>
            <option value="Estacionário">Estacionário</option>
            <option value="Industrial">Industrial</option>
          </select>
        </div>
        <div class="form-group">
          <label for="numeroSerie">Número de Série:</label>
          <input id="numeroSerie" type="text" />
        </div>
        <div class="form-group">
          <label for="dataProducao">Data de Produção:</label>
          <input id="dataProducao" type="date" />
        </div>
        <div class="form-group">
          <label for="lote">Lote de Fabricação:</label>
          <input id="lote" type="text" />
        </div>
      </div>
      <button class="btn-submit" onclick="registrarBateria()">Registrar Bateria</button>
    </section>

    <section id="gerenciar" class="content-section">
      <h2>Gerenciar Baterias</h2>

      <div class="form-grid">
        <div class="form-group">
          <label for="totalBaterias">TOTAL DE BATERIAS REGISTRADAS:</label>
          <input id="totalBaterias" type="text" disabled />
          <button class="btn-submit" onclick="atualizarTotal()">Atualizar</button>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="consultaId">ID da Bateria:</label>
          <input id="consultaId" type="number" placeholder="ID para consultar" />
          <button class="btn-submit" onclick="consultarPorId()">Consultar por ID</button>
        </div>

        <div class="form-group">
          <label for="serialRemover">Serial para remover:</label>
          <input id="serialRemover" type="text" placeholder="Número de série" />
          <button class="btn-submit" style="background-color:#DC3545;" onclick="removerPorSerial()">Remover</button>
        </div>
      </div>

      <h2>Lista Completa de Baterias</h2>
      <button class="btn-submit" onclick="listarBaterias()">Atualizar Lista</button>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nº de Série</th>
              <th>Tipo</th>
              <th>Uso</th>
              <th>Lote</th>
              <th>Data Produção</th>
              <th>Data Registro</th>
            </tr>
          </thead>
          <tbody id="lista"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="notificacao" class="notificacao"></div>

  <script>
    const abi = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "numeroSerie",
				"type": "string"
			}
		],
		"name": "BateriaRegistrada",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "baterias",
		"outputs": [
			{
				"internalType": "string",
				"name": "tipo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "uso",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "numeroSerie",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "dataProducao",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "lote",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getBateria",
		"outputs": [
			{
				"internalType": "string",
				"name": "tipo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "uso",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "numeroSerie",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "dataProducao",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "lote",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "listar",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "tipo",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "uso",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "numeroSerie",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "dataProducao",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "lote",
						"type": "string"
					}
				],
				"internalType": "struct BateriasDefeituosas.Bateria[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_tipo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_uso",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_numeroSerie",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_dataProducao",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_lote",
				"type": "string"
			}
		],
		"name": "registrarBateria",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "removerBateria",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
    ];
    const enderecoContrato = "0x45771D29DE0eD1308Cc03C7bB74a23E31844D5A8";

    let web3;
    let contrato;

    async function conectar() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        contrato = new web3.eth.Contract(abi, enderecoContrato);
      } else {
        mostrarNotificacao("erro", "MetaMask não detectado.");
      }
    }

    async function registrarBateria() {
      await conectar();
      const tipo = document.getElementById("tipo").value;
      const uso = document.getElementById("uso").value;
      const numeroSerie = document.getElementById("numeroSerie").value;
      const dataProducao = document.getElementById("dataProducao").value;
      const lote = document.getElementById("lote").value;

      const contas = await web3.eth.getAccounts();
      try {
        await contrato.methods.registrarBateria(tipo, uso, numeroSerie, dataProducao, lote)
          .send({ from: contas[0] });
        mostrarNotificacao("sucesso", "Bateria registrada com sucesso!");
      } catch (err) {
        console.error(err);
        mostrarNotificacao("erro", "Erro ao registrar bateria.");
      }
    }

    async function listarBaterias() {
      await conectar();
      const baterias = await contrato.methods.listar().call();
      const lista = document.getElementById("lista");
      lista.innerHTML = "";

      baterias.forEach((bateria, index) => {
        const linha = document.createElement("tr");
        linha.innerHTML = `
          <td>${index}</td>
          <td>${bateria.numeroSerie}</td>
          <td>${bateria.tipo}</td>
          <td>${bateria.uso}</td>
          <td>${bateria.lote}</td>
          <td>${bateria.dataProducao}</td>
          <td>${new Date().toLocaleDateString("pt-BR")}</td>
        `;
        lista.appendChild(linha);
      });
    }

    async function atualizarTotal() {
      await conectar();
      const baterias = await contrato.methods.listar().call();
      document.getElementById("totalBaterias").value = baterias.length;
    }

    async function consultarPorId() {
      await conectar();
      const id = document.getElementById("consultaId").value;
      try {
        const b = await contrato.methods.getBateria(id).call();
        mostrarNotificacao("sucesso", `ID ${id}: ${b.numeroSerie}, ${b.tipo}, ${b.uso}`);
      } catch {
        mostrarNotificacao("erro", "ID inválido ou não encontrado.");
      }
    }

    async function removerPorSerial() {
      await conectar();
      const serial = document.getElementById("serialRemover").value;
      const baterias = await contrato.methods.listar().call();
      const contas = await web3.eth.getAccounts();

      let removido = false;
      for (let i = 0; i < baterias.length; i++) {
        if (baterias[i].numeroSerie === serial) {
          await contrato.methods.removerBateria(i).send({ from: contas[0] });
          removido = true;
          break;
        }
      }

      if (removido) {
        mostrarNotificacao("sucesso", `Bateria com serial ${serial} removida.`);
        listarBaterias();
      } else {
        mostrarNotificacao("erro", "Serial não encontrado.");
      }
    }

    function mostrarSecao(id) {
      document.querySelectorAll(".content-section").forEach(secao => {
        secao.classList.remove("active");
      });
      document.getElementById(id).classList.add("active");

      document.querySelectorAll(".nav-link").forEach(link => {
        link.classList.remove("active");
      });
      document.querySelector(`.nav-link[onclick="mostrarSecao('${id}')"]`).classList.add("active");
    }

    function mostrarNotificacao(tipo, mensagem) {
      const notificacao = document.getElementById("notificacao");
      notificacao.className = `notificacao show ${tipo}`;
      notificacao.textContent = mensagem;
      setTimeout(() => {
        notificacao.className = "notificacao";
      }, 4000);
    }
  </script>
</body>
</html>